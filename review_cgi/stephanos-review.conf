# OpenBSD httpd configuration for Stephanos Review System
# Add this to /etc/httpd.conf on merah

# Server block for stephanos.symmachus.org
server "stephanos.symmachus.org" {
    listen on * port 80
    listen on * tls port 443

    # TLS configuration (if using HTTPS)
    # tls {
    #     certificate "/etc/ssl/stephanos.symmachus.org.crt"
    #     key "/etc/ssl/private/stephanos.symmachus.org.key"
    # }

    # Document root
    root "/htdocs"
    directory index index.html

    # CGI-bin location with authentication
    location "/cgi-bin/*.cgi" {
        fastcgi socket "/run/slowcgi.sock"
        authenticate "Stephanos Review System" with "/htpasswd"
    }

    # Protected images directory with authentication
    location "/protected/*" {
        authenticate "Stephanos Review System" with "/htpasswd"
        directory auto index
    }

    # Deny access to database directory
    location "/db/*" {
        block
    }

    # Allow access to main site
    location "/*" {
        pass
    }
}

# Notes for deployment:
# 1. Password file location: /var/www/vhosts/stephanos.symmachus.org/htpasswd
#    (referenced as /htpasswd relative to chroot)
# 2. Enable slowcgi for CGI execution:
#    rcctl enable slowcgi
#    rcctl start slowcgi
# 3. Restart httpd after config changes:
#    rcctl restart httpd
# 4. Check configuration:
#    httpd -n
